$cardSizeUnit: 7.5vw;

section {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  width: 100%;

  display: flex;
  justify-content: center;
  align-items: center;

  article {
    cursor: pointer;

    &:nth-of-type(1) {
      z-index: 1;
      width: calc(2 * $cardSizeUnit);
      transform: rotate(-15deg) translateY(0);
      margin-right: calc(0.2 * $cardSizeUnit);
    }
    &:nth-of-type(2) {
      z-index: 0;
      width: calc(1.5 * $cardSizeUnit);
      transform: rotate(10deg) translateY(calc(0.25 * $cardSizeUnit));
    }
    &:nth-of-type(3) {
      z-index: 1;
      width: calc(1.75 * $cardSizeUnit);
      transform: rotate(-10deg) translateY(calc(0.85 * $cardSizeUnit));
      margin-right: calc(0.35 * $cardSizeUnit);
    }
    &:nth-of-type(4) {
      z-index: 0;
      width: calc(1.5 * $cardSizeUnit);
      transform: rotate(20deg) translateY(0);
    }

    figure,
    .back {
      border-radius: calc(0.1 * $cardSizeUnit);
      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
    }

    figure {
      @import "variations";

      position: relative;

      aspect-ratio: 2 / 3;

      backface-visibility: hidden;

      img {
        width: 100%;
        height: 100%;
      }
    }

    .back {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;

      background-color: #fff;
      border: calc(0.1 * $cardSizeUnit) solid #fff;
      background-image: url(/src/card_back.png);
      background-repeat: no-repeat;
      background-position: 50% 50%;
      background-size: cover;

      backface-visibility: hidden;
      transform: rotateY(180deg);
    }

    &.flip {
      @for $i from 0 to 4 {
        &:nth-of-type(#{$i + 1}) {
          figure {
            animation: 1.2s ease-out calc(0.2s * #{$i}) flip-card;
          }
          .back {
            animation: 1.2s ease-out calc(0.2s * #{$i}) flip-card-back;
          }
        }
      }
    }
  }
}

@keyframes flip-card {
  0% {
    transform: perspective(800px) rotateY(0deg);
  }
  10% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(60deg);
  }
  50% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(180deg);
  }
  60% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(180deg);
  }
  100% {
    transform: perspective(800px) rotateY(360deg);
  }
}

@keyframes flip-card-back {
  0% {
    transform: perspective(800px) rotateY(180deg);
  }
  10% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(240deg);
  }
  50% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(360deg);
  }
  60% {
    transform: perspective(800px) translateX(calc(-0.3 * $cardSizeUnit))
      rotateY(360deg);
  }
  100% {
    transform: perspective(800px) rotateY(180deg);
  }
}
